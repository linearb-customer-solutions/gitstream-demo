manifest:
  version: 1.0

triggers:
  on:
    - pr_created
    - commit
    - pr_ready_for_review

automations:
  tag_claude_in_pr:
    if:
      - {{ is.claude_author or is.claude_co_author }}
    run:
      - action: add-label@v1
        args:
          label: 🤖 Claude Code

  tag_copilot_in_pr:
    if:
      - {{ is.copilot_author or is.copilot_co_author }}
    run:
      - action: add-label@v1
        args:
          label: 🤖 GitHub Copilot

  tag_cursor_in_pr:
    if:
      - {{ is.cursor_author or is.cursor_co_author }}
    run:
      - action: add-label@v1
        args:
          label: 🤖 Cursor AI

  tag_linearb_ai_in_pr:
    if:
      - {{ is.linearb_author or is.linearb_co_author }}
    run:
      - action: add-label@v1
        args:
          label: 🤖 LinearB AI

is:
  claude_author: {{ pr.author | lower | includes(regex=r/claude/) }}
  claude_co_author: {{ branch.commits.messages | match(regex=r/[Cc]o-[Aa]uthored-[Bb]y:.*[Cc]laude/) | some }}
  copilot_author: {{ pr.author | lower | includes(regex=r/copilot/) }}
  copilot_co_author: {{ branch.commits.messages | match(regex=r/[Cc]o-[Aa]uthored-[Bb]y:.*([Cc]opilot|[Gg]ithub.*[Cc]opilot)/) | some }}
  cursor_author: {{ pr.author | lower | includes(regex=r/cursor/) }}
  cursor_co_author: {{ branch.commits.messages | match(regex=r/[Cc]o-[Aa]uthored-[Bb]y:.*[Cc]ursor/) | some }}
  linearb_author: {{ pr.author | lower | includes(regex=r/^linearb/) and not (pr.author | lower | includes(regex=r/^linearbci$/)) }}
  linearb_co_author: {{ branch.commits.messages | match(regex=r/[Cc]o-[Aa]uthored-[Bb]y:.*(gitstream-cm|linearb).*\\[bot\\]/) | some }}
